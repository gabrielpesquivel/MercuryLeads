{% extends "base.html" %}

{% block title %}Projects{% endblock %}

{% block content %}
  <h1>Projects</h1>

  <form method="post">
    <label>Project Name:</label>
    <input type="text" name="name" required>
    <label>Organisation:</label>
    <input type="text" name="organisation" required>
    <label>City:</label>
    <input type="text" name="city">
    <label>Install Target Date:</label>
    <input type="text" name="install_target">
    <label>Action Required:</label>
    <input type="text" name="action_required">
    <button type="submit">Add Project</button>
  </form>

  <h2>Existing Projects</h2>
  <table border="1">
    <tr>
      <th>Project Name</th>
      <th>Organisation</th>
      <th>City</th>
      <th>Install Target</th>
      <th>Action Required</th>
      <th>Contacts</th>
      <th>Actions</th>
    </tr>
    {% for project in projects %}
      <tr>
        <td>{{ project.name }}</td>
        <td>{{ project.organisation }}</td>
        <td>{{ project.city }}</td>
        <td>{{ project.install_target if project.install_target else "N/A" }}</td>
        <td>{{ project.action_required if project.action_required else "N/A" }}</td>
        <td>
          {% for contact in project.contacts %}
            {{ contact.first_name }} {{ contact.last_name }} ({{ contact.email }})<br>
          {% endfor %}
        </td>
        <td>
          <div class="action-container">
            <!-- Delete and Update Buttons Inline -->
            <div class="actions">
              <!-- Delete Button -->
              <form action="{{ url_for('delete_project', project_id=project.id) }}" method="post">
                <button type="submit" onclick="return confirm('Are you sure you want to delete this project?');">
                  Delete
                </button>
              </form>

              <!-- Update Button -->
              <form action="{{ url_for('update_project', project_id=project.id) }}" method="post">
                <button type="submit">Update</button>
              </form>
            </div>

            <!-- Text Box for New Action (Appears Beneath) -->
            <form action="{{ url_for('update_project', project_id=project.id) }}" method="post">
              <input type="text" name="new_action" placeholder="New Action" required>
            </form>
          </div>
        </td>
      </tr>
    {% endfor %}
  </table>

{% endblock %}
